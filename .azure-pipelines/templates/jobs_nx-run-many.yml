parameters:
  - name: jobName
    type: string
  - name: dependsOn
    type: string
  - name: commandStr
    type: string
  - name: target
    type: string
  - name: isProdBuild
    type: boolean
    default: false

jobs:
  - job: ${{ parameters.jobName }}
    displayName: nx run many - ${{ parameters.target }}
    dependsOn: ${{ parameters.dependsOn }}
    condition: |
      and(
        succeeded(),
        not(
          contains(
            parameters.commandStr,
            '"${{ parameters.target }}":[]'
          )
        )
      )
    variables:
      commandStr: ${{ parameters.commandStr }}
      target: ${{ parameters.target }}
      env: 'development'
      ${{ if eq(parameters.isProdBuild, 'true') }}:
        env: 'production'
    steps:
      - template: steps_install-node-modules.yml
      - script: node ./tools/scripts/nx-run-many.js '$(commandStr)' $(target) $(env)
